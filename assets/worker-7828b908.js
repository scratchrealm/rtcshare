(function(){"use strict";var V=function(e,s,t,a){function c(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function l(i){try{u(a.next(i))}catch(f){o(f)}}function r(i){try{u(a.throw(i))}catch(f){o(f)}}function u(i){i.done?n(i.value):c(i.value).then(l,r)}u((a=a.apply(e,s||[])).next())})};let g,p,w,S;onmessage=function(e){e.data.canvas&&(g=e.data.canvas,_()),e.data.opts&&(p=e.data.opts,_()),e.data.resolvedSeries&&(w=e.data.resolvedSeries,_())};function W(e,s){let t=!1;return()=>{t||(t=!0,setTimeout(()=>{t=!1,e()},s))}}let P=0;function I(){return V(this,void 0,void 0,function*(){if(!g||!p||!w)return;const{margins:e,canvasWidth:s,canvasHeight:t,visibleStartTimeSec:a,visibleEndTimeSec:c,minValue:n,maxValue:o}=p;g.width=s,g.height=t;const l=g.getContext("2d");if(!l)return;P+=1;const r=P;for(const u of S?[1,2]:[1]){if(r!==P)return;const i=Date.now();(u===2||!S)&&(S=H(w));const f=b=>({x:e.left+(b.x-a)/(c-a)*(s-e.left-e.right),y:t-e.bottom-(b.y-n)/(o-n)*(t-e.top-e.bottom)}),d=f({x:0,y:0}).y,y=S.map((b,h)=>({dimensionIndex:h,dimensionLabel:`${h}`,pixelTimes:b.times.map(m=>f({x:m,y:0}).x),pixelValues:b.values.map(m=>f({x:0,y:m}).y),type:b.type,attributes:b.attributes}));C(l,{pixelZero:d,dimensions:y});const T=Date.now()-i;yield x(T)}})}const _=W(I,10),M=e=>{if(!p||p.hideLegend||!w)return;const{legendOpts:s,margins:t,canvasWidth:a}=p,c=w.filter(y=>y.title);if(c.length===0)return;const{location:n}=s,o=18,l=12,r=50,u=200,i=10,f=20+c.length*o,d=n==="northwest"?{x:t.left+20,y:t.top+20,w:u,h:f}:n==="northeast"?{x:a-t.right-u-20,y:t.top+20,w:u,h:f}:void 0;d&&(e.fillStyle="white",e.strokeStyle="gray",e.lineWidth=1.5,e.fillRect(d.x,d.y,d.w,d.h),e.strokeRect(d.x,d.y,d.w,d.h),c.forEach((y,R)=>{var T;const b=d.y+i+R*o,h={x:d.x+i,y:b,w:r,h:o},m={x:d.x+i+r+i,y:b,w:u-i-i-r-i,h:o},A=y.title||"untitled";if(e.fillStyle="black",e.font=`${l}px Arial`,e.fillText(A,m.x,m.y+m.h/2+l/2),y.type==="line")D(e,y.attributes),e.beginPath(),e.moveTo(h.x,h.y+h.h/2),e.lineTo(h.x+h.w,h.y+h.h/2),e.stroke(),e.setLineDash([]);else if(y.type==="marker"){E(e,y.attributes);const v=o*.3,L=(T=y.attributes.shape)!==null&&T!==void 0?T:"circle",k={x:h.x+h.w/2,y:h.y+h.h/2};L==="circle"?(e.beginPath(),e.ellipse(k.x,k.y,v,v,0,0,2*Math.PI),e.fill()):L==="square"&&e.fillRect(k.x-v,k.y-v,v*2,v*2)}}))},C=(e,s)=>{if(!p)return;const{margins:t,canvasWidth:a,canvasHeight:c}=p;e.clearRect(0,0,a,c),e.save(),e.beginPath(),e.rect(t.left,t.top,a-t.left-t.right,c-t.top-t.bottom),e.clip(),s.dimensions.forEach(n=>{var o,l;if(n.type==="line")D(e,n.attributes),e.beginPath(),n.pixelTimes.forEach((r,u)=>{const i=n.pixelValues[u];u===0?e.moveTo(r,i):e.lineTo(r,i)}),e.stroke(),e.setLineDash([]);else if(n.type==="marker"){E(e,n.attributes);const r=(o=n.attributes.radius)!==null&&o!==void 0?o:2,u=(l=n.attributes.shape)!==null&&l!==void 0?l:"circle";u==="circle"?n.pixelTimes.forEach((i,f)=>{e.beginPath(),e.ellipse(i,n.pixelValues[f],r,r,0,0,2*Math.PI),e.fill()}):u==="square"&&n.pixelTimes.forEach((i,f)=>{e.fillRect(i-r,n.pixelValues[f]-r,r*2,r*2)})}}),M(e),e.restore()},H=e=>{const s=[];if(!p)return s;const{visibleStartTimeSec:t,visibleEndTimeSec:a}=p;return t===void 0||a===void 0||e.forEach(c=>{const n=c.t,o=c.y;let l=n.flatMap((i,f)=>t<=i&&i<=a?f:[]);(l[0]||0)>0&&(l=[l[0]-1,...l]),(l[l.length-1]||n.length)<n.length-1&&l.push(l[l.length-1]+1);const r=l.map(i=>n[i]),u=l.map(i=>o[i]);s.push({type:c.type,times:r,values:u,attributes:c.attributes})}),s},D=(e,s)=>{var t,a;e.strokeStyle=(t=s.color)!==null&&t!==void 0?t:"black",e.lineWidth=(a=s.width)!==null&&a!==void 0?a:1.1,s.dash&&e.setLineDash(s.dash)},E=(e,s)=>{var t;e.fillStyle=(t=s.color)!==null&&t!==void 0?t:"black"};function x(e){return new Promise(s=>{setTimeout(s,e)})}})();
